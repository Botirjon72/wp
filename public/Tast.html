<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cyberpunk Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;600;700&display=swap" rel="stylesheet">
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  background: #0a0a0a;
  color: #fff;
  font-family: 'Rajdhani', sans-serif;
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  padding-bottom: 60px;
}

.user-info {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 15px 20px;
  border-bottom: 1px solid #0ff;
  flex-wrap: wrap;
  gap: 10px;
}

.user-profile {
  display: flex;
  align-items: center;
  gap: 10px;
}

.avatar {
  width: 50px;
  height: 50px;
  border-radius: 12px;
  border: 2px solid #0ff;
  object-fit: cover;
}

.toggle-buttons {
  display: flex;
  justify-content: center;
  gap: 10px;
  margin: 20px;
  flex-wrap: wrap;
}

.toggle-buttons button {
  background: #1a1a2e;
  color: #fff;
  border: none;
  padding: 10px 20px;
  border-radius: 10px;
  cursor: pointer;
  font-weight: bold;
  min-width: 100px;
  transition: 0.3s;
  flex: 1 1 30%;
}

.toggle-buttons button:hover {
  background: #0ff;
  color: #000;
}

main {
  flex: 1;
  padding: 0 20px;
}

.section {
  display: none;
}

.section.active {
  display: block;
}

/* Referal kartalar: kichikroq va burchakliroq */
.task-item,
.reward-card {
  background: rgba(255, 255, 255, 0.05);
  padding: 12px;
  border-radius: 10px;
  margin-bottom: 8px;
  border: 1px solid #0ff;
  transition: 0.3s;
  max-width: 400px;
}

.task-item.completed,
.reward-card.claimed {
  border-color: #0f0;
  background: rgba(0, 255, 0, 0.1);
}

.reward-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 10px;
  gap: 10px;
}

.reward-header img,
.reward-header video {
  width: 40px;
  height: 40px;
  border-radius: 8px;
  object-fit: cover;
  border: 2px solid #0ff;
}

.reward-coins {
  display: block;
  margin-bottom: 8px;
  font-size: 0.95rem;
}

.claim-btn {
  padding: 5px 10px;
  background: linear-gradient(135deg, #0ff, #0f0);
  border: none;
  border-radius: 6px;
  cursor: pointer;
  color: #000;
  font-weight: bold;
  transition: 0.3s;
  font-size: 0.9rem;
}

.claim-btn:disabled {
  background: #555;
  color: #aaa;
  cursor: not-allowed;
}

.claim-btn:hover:not(:disabled) {
  transform: scale(1.05);
  box-shadow: 0 0 10px #0ff;
}

.progress-bar {
  background: #333;
  border-radius: 15px;
  height: 8px;
  overflow: hidden;
  margin-top: 5px;
}

.progress {
  background: linear-gradient(90deg, #0ff, #0f0);
  height: 100%;
  transition: width 0.3s ease;
}

footer {
  position: fixed;
  bottom: 0;
  width: 100%;
  background: rgba(0, 0, 0, 0.9);
  color: #fff;
  text-align: center;
  padding: 10px;
  border-top: 1px solid #0ff;
  font-size: 14px;
}

/* Mobil qurilmalarga moslashuv */
@media (max-width: 480px) {
  .toggle-buttons button {
    flex: 1 1 30%;
    font-size: 14px;
    padding: 8px;
  }

  .reward-card {
    max-width: 100%;
  }
}

.referral-link-container {
  background: rgba(0, 0, 0, 0.5);
  padding: 15px;
  border-radius: 10px;
  margin: 15px 0;
  border: 1px solid #0ff;
  word-break: break-word;
}

.referral-link-container a {
  color: #0ff;
  text-decoration: none;
  font-weight: 600;
}

.referral-link-container img,
.referral-link-container video {
  width: 45px;
  height: 45px;
  border-radius: 10px;
  border: 2px solid #0ff;
  object-fit: cover;
  display: inline-block;
  margin-right: 10px;
  vertical-align: middle;
}

.referral-buttons {
  display: flex;
  gap: 10px;
  margin-top: 15px;
  flex-wrap: wrap;
}

.referral-btn {
  background: linear-gradient(135deg, #1a1a2e, #16213e);
  color: #0ff;
  border: 2px solid #0ff;
  padding: 10px 20px;
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.3s ease;
  font-weight: 600;
  flex: 1;
  min-width: 120px;
}

.referral-btn:hover {
  background: linear-gradient(135deg, #0ff, #0f0);
  color: #000;
  transform: translateY(-2px);
  box-shadow: 0 10px 20px rgba(0, 255, 255, 0.3);
}
</style>

</head>
<body>
  <div class="user-info">
    <div class="user-profile">
      <img id="avatar" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='60' height='60' viewBox='0 0 60 60'%3E%3Ccircle cx='30' cy='30' r='30' fill='%23333'/%3E%3Ccircle cx='30' cy='25' r='8' fill='%230ff'/%3E%3Cpath d='M15 45c0-8 7-15 15-15s15 7 15 15' fill='%230ff'/%3E%3C/svg%3E" alt="Avatar" class="avatar">
      <div class="user-details">
        <h3 id="name">Yuklanmoqda...</h3>
        <p id="level">Level: --</p>
        <p id="xp">XP: --</p>
      </div>
    </div>
    <div class="user-stats">
      <p id="rank">Rank: --</p>
      <p id="coins" class="coins">üí∞ Tanga: --</p>
    </div>
  </div>

  <div class="toggle-buttons">
    <button id="tasksBtn" class="active" onclick="showSection('tasks')">üéØ Kundalik Vazifalar</button>
    <button id="ranksBtn" onclick="showSection('ranks')">üèÜ Leagues</button>
    <button id="referralsBtn" onclick="showSection('referrals')">üë• Referral</button>
  </div>

  <main>
    <div id="tasksSection" class="section active">
      <h2>üéØ Kundalik Vazifalar</h2>
      <div id="taskList"></div>
    </div>

    <div id="ranksSection" class="section">
      <h2>üèÜ Rank Mukofotlari</h2>
      <div id="rankList"></div>
    </div>

    <div id="referralsSection" class="section">
      <h2>üë• Referral Mukofotlari</h2>
      <div id="referralInfo"></div>
      <div id="referralList"></div>
    </div>
  </main>

  <footer>
    üöÄ CYBERPUNK DASHBOARD - KELAJAK ENDI BOSHLANDI!
  </footer>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script>
const tg = window.Telegram?.WebApp;
const userId = tg.initDataUnsafe?.user?.id;

function loadUser() {
  const tg = window.Telegram?.WebApp;
  const userId = tg?.initDataUnsafe?.user?.id;

  if (!userId) {
    document.getElementById('name').textContent = 'Telegram ID topilmadi!';
    document.getElementById('avatar').src = './img/default.jpg';
    return;
  }

  fetch(`/api/user?telegram_id=${userId}`)
    .then(res => {
      if (!res.ok) throw new Error("Foydalanuvchi topilmadi");
      return res.json();
    })
    .then(data => {
      document.getElementById('name').textContent = data.name || 'Noma ºlum';
      document.getElementById('level').textContent = `Level: ${data.level}`;
      document.getElementById('xp').textContent = `XP: ${data.xp}`;
      document.getElementById('rank').textContent = `Rank: ${data.rank} | Score: ${data.score}`;
      document.getElementById('coins').textContent = `Tanga: ${data.coins}`;
      document.getElementById('avatar').src = data.avatar?.trim() ? data.avatar : './img/default.jpg';
    })
    .catch(err => {
      console.error(err);
      document.getElementById('name').textContent = 'Xatolik!';
      document.getElementById('avatar').src = './img/default.jpg';
    });
}

const STORAGE_KEYS = {
  USER_DATA: 'cyberpunk_user_data',
  TASKS: 'cyberpunk_tasks',
  RANKS: 'cyberpunk_ranks',
  REFERRALS: 'cyberpunk_referrals'
};

// Notification ko'rsatish
function showNotification(message, type = 'success') {
  const notification = document.createElement('div');
  notification.className = 'notification';
  notification.textContent = message;
  
  if (type === 'error') {
    notification.style.background = 'linear-gradient(135deg, #ff4444, #ff6666)';
    notification.style.color = '#fff';
  }
  
  document.body.appendChild(notification);
  
  setTimeout(() => notification.classList.add('show'), 100);
  
  setTimeout(() => {
    notification.classList.remove('show');
    setTimeout(() => document.body.removeChild(notification), 300);
  }, 3000);
}

  


// Foydalanuvchi ma'lumotlarini saqlash
function saveUserData(updates) {
  const savedData = localStorage.getItem(STORAGE_KEYS.USER_DATA);
  const userData = savedData ? JSON.parse(savedData) : {};
  
  const updatedData = { ...userData, ...updates };
  localStorage.setItem(STORAGE_KEYS.USER_DATA, JSON.stringify(updatedData));
  
  loadUser(); // UI ni yangilash
}



// Kundalik vazifalar
let tasks = [
  { 
    id: 1, 
    name: 'üöÄ Botni ishga tushiring', 
    desc: 'Telegram botni birinchi marta ishga tushiring va bonus oling.', 
    reward: 500, 
    done: false,
    type: 'daily'
  },
  { 
    id: 2, 
    name: 'üë§ Profilni to\'ldiring', 
    desc: 'O\'z profilingizni to\'ldiring va qo\'shimcha mukofot oling.', 
    reward: 1000, 
    done: false,
    type: 'profile'
  },
  { 
    id: 3, 
    name: 'üìÖ Kunlik kirish', 
    desc: 'Har kuni tizimga kirib, kunlik bonusni oling.', 
    reward: 300, 
    done: false,
    type: 'daily'
  },
  { 
    id: 4, 
    name: 'üéÆ 10 marta o\'yin o\'ynang', 
    desc: 'Biror o\'yinni 10 marta o\'ynab, tajriba to\'plang.', 
    reward: 750, 
    done: false,
    type: 'gaming'
  },
  { 
    id: 5, 
    name: '‚≠ê 5 ta yulduz bering', 
    desc: 'Ilovaga 5 yulduzli baho bering va mukofot oling.', 
    reward: 1500, 
    done: false,
    type: 'rating'
  }
];

function loadTasks() {
  const savedTasks = localStorage.getItem(STORAGE_KEYS.TASKS);
  if (savedTasks) {
    tasks = JSON.parse(savedTasks);
  }
  
  const list = document.getElementById('taskList');
  list.innerHTML = '';
  
  tasks.forEach(task => {
    const div = document.createElement('div');
    div.className = 'task-item' + (task.done ? ' completed' : '');
    div.innerHTML = `
      <h4>${task.name}</h4>
      <p>${task.desc}</p>
      <p style="color: #ffd700; font-weight: 600;">üéÅ Mukofot: ${task.reward.toLocaleString()} tanga</p>
      <div class="progress-bar">
        <div class="progress" style="width: ${task.done ? 100 : 0}%;"></div>
      </div>
      ${task.done 
        ? '<p style="color:#0f0; font-weight: 600; margin-top: 10px;">‚úÖ Bajarilgan</p>' 
        : `<button onclick="completeTask(${task.id})" class="claim-btn" style="margin-top: 10px;">Bajarish</button>`
      }
    `;
    list.appendChild(div);
  });
}

function completeTask(id) {
  const task = tasks.find(t => t.id === id);
  if (task && !task.done) {
    task.done = true;
    
    // Foydalanuvchiga tanga qo'shish
    const userData = JSON.parse(localStorage.getItem(STORAGE_KEYS.USER_DATA));
    userData.coins += task.reward;
    userData.xp += Math.floor(task.reward / 10);
    
    // Level tekshirish
    if (userData.xp >= userData.level * 1000) {
      userData.level += 1;
      showNotification(`üéâ Tabriklaymiz! ${userData.level} levelga ko'tarildingiz!`);
    }
    
    localStorage.setItem(STORAGE_KEYS.USER_DATA, JSON.stringify(userData));
    localStorage.setItem(STORAGE_KEYS.TASKS, JSON.stringify(tasks));
    
    showNotification(`‚úÖ Vazifa bajarildi! +${task.reward.toLocaleString()} tanga olindi!`);
    loadTasks();
    loadUser();
  }
}

// Rank mukofotlari
let ranks = [
  {
  name: 'Bodiring',
  reward: 10000,
  progress: 100,
  claimed: false,
  video: './img/bodring.mp4',
  requirement: 'Level 10 ga yeting'
},
  {
  name: 'Jon',
  reward: 10000,
  progress: 100,
  claimed: false,
  video: './img/jon.mp4',
  requirement: 'Level 10 ga yeting'
}
,
    {
  name: 'Ali',
  reward: 10000,
  progress: 100,
  claimed: false,
  video: './img/ali.mp4',
  requirement: 'Level 10 ga yeting'
},
  {
  name: 'Asmu',
  reward: 10000,
  progress: 100,
  claimed: false,
  video: './img/asmu.mp4',
  requirement: 'Level 10 ga yeting'
},
  {
  name: 'Xushnud',
  reward: 10000,
  progress: 100,
  claimed: false,
  video: './img/xushnud.mp4',
  requirement: 'Level 10 ga yeting'
},
  {
  name: 'Beg',
  reward: 10000,
  progress: 100,
  claimed: false,
  video: './img/beg.mp4',
  requirement: 'Level 10 ga yeting'
},
  {
  name: 'Assi',
  reward: 10000,
  progress: 100,
  claimed: false,
  video: './img/assi.mp4',
  requirement: 'Level 10 ga yeting'
},
  {
  name: 'Poxoyzm',
  reward: 10000,
  progress: 100,
  claimed: false,
  video: './img/last.mp4',
  requirement: 'Level 10 ga yeting'
}
];

function loadRanks() {
  const savedRanks = localStorage.getItem(STORAGE_KEYS.RANKS);
  if (savedRanks) {
    ranks = JSON.parse(savedRanks);
  }

  const list = document.getElementById('rankList');
  list.innerHTML = '';

  ranks.forEach((rank, idx) => {
    const div = document.createElement('div');
    div.className = 'reward-card' + (rank.claimed ? ' claimed' : '');

    // Tasvir yoki video tayyorlash
    let mediaHtml = '';
    if (rank.video) {
      mediaHtml = `
        <video width="45" height="45" autoplay loop muted playsinline>
          <source src="${rank.video}" type="video/mp4">
          Video qo'llab-quvvatlanmaydi.
        </video>
      `;
    } else if (rank.img) {
      mediaHtml = `<img src="${rank.img}" alt="${rank.name}">`;
    }

    div.innerHTML = `
      <div class="reward-header">
        ${mediaHtml}
        <span>${rank.name} Rank</span>
        ${rank.progress >= 100 && !rank.claimed
          ? `<button onclick="claimRank(${idx})" class="claim-btn">Olish</button>`
          : `<button disabled class="claim-btn">${rank.claimed ? 'Olingan' : 'Kutish'}</button>`}
      </div>
      <span class="reward-coins">ü™ô ${rank.reward.toLocaleString()} tanga</span>
      <p style="color: #aaa; margin-bottom: 10px;">${rank.requirement}</p>
      <div class="progress-bar">
        <div class="progress" style="width:${rank.progress}%;"></div>
      </div>
      <p style="color: #0ff; font-size: 0.9rem; margin-top: 5px;">Progress: ${rank.progress}%</p>
    `;
    list.appendChild(div);
  });
}


function claimRank(idx) {
  if (ranks[idx].progress >= 100 && !ranks[idx].claimed) {
    ranks[idx].claimed = true;
    
    // Foydalanuvchiga tanga qo'shish
    const userData = JSON.parse(localStorage.getItem(STORAGE_KEYS.USER_DATA));
    userData.coins += ranks[idx].reward;
    
    localStorage.setItem(STORAGE_KEYS.USER_DATA, JSON.stringify(userData));
    localStorage.setItem(STORAGE_KEYS.RANKS, JSON.stringify(ranks));
    
    showNotification(`üèÜ ${ranks[idx].name} mukofoti olindi! +${ranks[idx].reward.toLocaleString()} tanga!`);
    loadRanks();
    loadUser();
  }
}

// Referral tizimi
let referrals = [
  { 
    count: 1, 
    reward: 2500, 
    progress: 0, 
    claimed: false, 
    img: './img/referal1.jpg',
    description: '1 ta do\'st taklif qiling'
  },
  { 
    count: 3, 
    reward: 7500, 
    progress: 0, 
    claimed: false, 
    img: 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="45" height="45" viewBox="0 0 45 45"%3E%3Ccircle cx="22.5" cy="22.5" r="22.5" fill="%230f0"/%3E%3Ctext x="22.5" y="28" text-anchor="middle" fill="%23000" font-size="16" font-weight="bold"%3E3%3C/text%3E%3C/svg%3E',
    description: '3 ta do\'st taklif qiling'
  },
  { 
    count: 10, 
    reward: 25000, 
    progress: 0, 
    claimed: false, 
    img: 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="45" height="45" viewBox="0 0 45 45"%3E%3Ccircle cx="22.5" cy="22.5" r="22.5" fill="%23ffd700"/%3E%3Ctext x="22.5" y="28" text-anchor="middle" fill="%23000" font-size="14" font-weight="bold"%3E10%3C/text%3E%3C/svg%3E',
    description: '10 ta do\'st taklif qiling'
  },
  { 
    count: 25, 
    reward: 75000, 
    progress: 0, 
    claimed: false, 
    img: 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="45" height="45" viewBox="0 0 45 45"%3E%3Ccircle cx="22.5" cy="22.5" r="22.5" fill="%23ff6b6b"/%3E%3Ctext x="22.5" y="28" text-anchor="middle" fill="%23fff" font-size="14" font-weight="bold"%3E25%3C/text%3E%3C/svg%3E',
    description: '25 ta do\'st taklif qiling'
  }
];

function loadReferrals() {
  const savedReferrals = localStorage.getItem(STORAGE_KEYS.REFERRALS);
  if (savedReferrals) {
    referrals = JSON.parse(savedReferrals);
  }
  
  displayReferralLink();
  renderReferrals();
}

function renderReferrals() {
  const list = document.getElementById('referralList');
  list.innerHTML = '';
  
  referrals.forEach((ref, idx) => {
    const div = document.createElement('div');
    div.className = 'reward-card' + (ref.claimed ? ' claimed' : '');
    div.innerHTML = `
      <div class="reward-header">
        <img src="${ref.img}" alt="Invite ${ref.count} Friends">
        <span>${ref.description}</span>
        ${ref.progress >= 100 && !ref.claimed
          ? `<button onclick="claimReferral(${idx})" class="claim-btn">Olish</button>`
          : `<button disabled class="claim-btn">${ref.claimed ? 'Olingan' : 'Kutish'}</button>`}
      </div>
      <span class="reward-coins">ü™ô ${ref.reward.toLocaleString()} tanga</span>
      <div class="progress-bar">
        <div class="progress" style="width:${ref.progress}%;"></div>
      </div>
      <p style="color: #0ff; font-size: 0.9rem; margin-top: 5px;">Progress: ${Math.floor(ref.progress)}%</p>
    `;
    list.appendChild(div);
  });
}

function claimReferral(idx) {
  if (referrals[idx].progress >= 100 && !referrals[idx].claimed) {
    referrals[idx].claimed = true;
    
    // Foydalanuvchiga tanga qo'shish
    const userData = JSON.parse(localStorage.getItem(STORAGE_KEYS.USER_DATA));
    userData.coins += referrals[idx].reward;
    
    localStorage.setItem(STORAGE_KEYS.USER_DATA, JSON.stringify(userData));
    localStorage.setItem(STORAGE_KEYS.REFERRALS, JSON.stringify(referrals));
    
    showNotification(`üë• Referral mukofoti olindi! +${referrals[idx].reward.toLocaleString()} tanga!`);
    renderReferrals();
    loadUser();
  }
}

// Referral havolasi generatsiyasi
function generateReferralLink() {
  const baseUrl = window.location.origin;
  return `${baseUrl}?ref=${userId}`;
}

// Referral havolasini ko'rsatish
function displayReferralLink() {
  const link = generateReferralLink();
  const referralInfo = document.getElementById('referralInfo');
  
  referralInfo.innerHTML = `
    <div style="background: rgba(0, 255, 255, 0.1); padding: 20px; border-radius: 15px; margin-bottom: 25px; border: 2px solid rgba(0, 255, 255, 0.3);">
      <h3 style="color: #0ff; margin-bottom: 15px; text-align: center;">üîó Sizning Referral Havolangiz</h3>
      <div class="referral-link-container">
        <a href="${link}" target="_blank" id="referralLink">${link}</a>
      </div>
      <div class="referral-buttons">
        <button onclick="copyToClipboard('${link}')" class="referral-btn">üìã Nusxalash</button>
        <button onclick="shareReferral()" class="referral-btn">üì§ Ulashish</button>
        
      </div>
      <p style="color: #aaa; text-align: center; margin-top: 15px; font-size: 0.9rem;">
        Do'stlaringizni taklif qiling va har bir faol do'st uchun bonus oling!
      </p>
    </div>
  `;
}

// Havolani nusxalash
function copyToClipboard(text) {
  if (navigator.clipboard) {
    navigator.clipboard.writeText(text).then(() => {
      showNotification('üìã Havola nusxalandi!');
    }).catch(() => {
      fallbackCopyTextToClipboard(text);
    });
  } else {
    fallbackCopyTextToClipboard(text);
  }
}

function fallbackCopyTextToClipboard(text) {
  const textArea = document.createElement("textarea");
  textArea.value = text;
  textArea.style.top = "0";
  textArea.style.left = "0";
  textArea.style.position = "fixed";
  document.body.appendChild(textArea);
  textArea.focus();
  textArea.select();
  
  try {
    document.execCommand('copy');
    showNotification('üìã Havola nusxalandi!');
  } catch (err) {
    showNotification('‚ùå Nusxalashda xatolik!', 'error');
  }
  
  document.body.removeChild(textArea);
}

// Havolani ulashish
function shareReferral() {
  const link = generateReferralLink();
  const shareData = {
    title: 'Cyberpunk Dashboard ga qo\'shiling!',
    text: 'Mening referral havolam orqali ro\'yxatdan o\'ting va bonus oling!',
    url: link,
  };
  
  if (navigator.share) {
    navigator.share(shareData).then(() => {
      showNotification('üì§ Havola ulashildi!');
    }).catch((err) => {
      console.error('Ulashishda xatolik:', err);
      copyToClipboard(link);
    });
  } else {
    copyToClipboard(link);
    showNotification('üìã Havola nusxalandi! Uni do\'stlaringiz bilan ulashing.');
  }
}

// Test uchun referral simulatsiyasi
function simulateReferral() {
  const currentReferrals = parseInt(localStorage.getItem('current_referrals') || '0');
  const newReferrals = currentReferrals + 1;
  localStorage.setItem('current_referrals', newReferrals.toString());
  
  // Referral progressni yangilash
  referrals.forEach(ref => {
    ref.progress = Math.min(100, (newReferrals / ref.count) * 100);
  });
  
  localStorage.setItem(STORAGE_KEYS.REFERRALS, JSON.stringify(referrals));
  
  showNotification(`üéâ Yangi referral qo'shildi! Jami: ${newReferrals}`);
  renderReferrals();
}

// Bo'limlarni ko'rsatish
function showSection(section) {
  // Barcha bo'limlarni yashirish
  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('.toggle-buttons button').forEach(btn => btn.classList.remove('active'));
  
  // Tanlangan bo'limni ko'rsatish
  document.getElementById(section + 'Section').classList.add('active');
  document.getElementById(section + 'Btn').classList.add('active');
}

// Progress yangilash (level asosida)
function updateProgress() {
  const userData = JSON.parse(localStorage.getItem(STORAGE_KEYS.USER_DATA) || '{}');
  const userLevel = userData.level || 1;
  
  // Rank progressni yangilash
  ranks.forEach(rank => {
    switch(rank.name) {
      case 'Silver':
        rank.progress = Math.min(100, (userLevel / 5) * 100);
        break;
      case 'Gold':
        rank.progress = Math.min(100, (userLevel / 10) * 100);
        break;
      case 'Platinum':
        rank.progress = Math.min(100, (userLevel / 20) * 100);
        break;
      case 'Diamond':
        rank.progress = Math.min(100, (userLevel / 50) * 100);
        break;
    }
  });
  
  localStorage.setItem(STORAGE_KEYS.RANKS, JSON.stringify(ranks));
}

// Sahifa yuklanganda barcha ma'lumotlarni yuklash
window.onload = () => {
  // Loading animatsiyasini ko'rsatish
  document.getElementById('name').innerHTML = '<span class="loading"></span> Yuklanmoqda...';
  
  setTimeout(() => {
    loadUser();
    loadTasks();
    updateProgress();
    loadRanks();
    loadReferrals();
    
    showNotification('üöÄ Dashboard muvaffaqiyatli yuklandi!');
  }, 1000);
};

// Har 30 soniyada progress yangilanadi
setInterval(updateProgress, 30000);

// Telegram WebApp sozlamalari
if (tg.initData) {
  tg.ready();
  tg.expand();
}
let mediaHtml = '';
if (rank.video) {
  mediaHtml = `
    <video 
      width="45" 
      height="45" 
      autoplay 
      loop 
      muted 
      playsinline 
      style="border-radius: 50%; object-fit: cover;">
      <source src="${rank.video}" type="video/mp4">
      Video qo'llab-quvvatlanmaydi.
    </video>
  `;
} else if (rank.img) {
  mediaHtml = `<img src="${rank.img}" alt="${rank.name}" style="width: 45px; height: 45px; border-radius: 50%; object-fit: cover;">`;
}

  </script>
</body>
</html>